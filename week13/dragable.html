<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <p id="container">
    温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡
    温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡
    温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡
    温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡
    温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡
    温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡温暖温暖温暖洒是你的卡时间都看了撒娇时间到了卡
  </p>
  <div id="drag" style="width: 100px; height: 100px; background-color: pink; display: inline-block;"></div>
  <script>


    class Drag {
      constructor(element) {
        this.element = element;
        this.baseX = 0;
        this.baseY = 0;
        this.down = null;
        this.init()
      }
      init() {
        this.down = (event) => {
          const startX = event.clientX, startY = event.clientY;
          const move = (event) => {
            const range = nearest(event.clientX, event.clientY)
            range.insertNode(this.element)
            // const x = this.baseX + event.clientX - startX, y = this.baseY + event.clientY - startY;
            // this.element.style.transform = `translate(${x}px, ${y}px)`
          };
          const up = (event) => {
            this.baseX = this.baseX + event.clientX - startX;
            this.baseY = this.baseY + event.clientY - startY;
            document.removeEventListener('mousemove', move)
            document.removeEventListener('mouseup', up)
          };
          document.addEventListener('mousemove', move)
          document.addEventListener('mouseup', up)
        };
        this.element.addEventListener('mousedown', this.down)
      }
      destroyed() {
        this.element.removeEventListener('mousedown', this.down)
      }
    };

    const drag = new Drag(document.getElementById('drag'))

    const container = document.getElementById('container')
    const ranges = []

    for(let i = 0; i < container.childNodes[0].textContent.length; i++) {
      const range = document.createRange()
      range.setStart(container.childNodes[0], i)
      range.setEnd(container.childNodes[0], i)
      ranges.push(range)
    }


    function nearest(x0, y0) {
      let nearestRange = null
      let distance = Infinity
      for(let range of ranges) {
        let  {x, y} = range.getBoundingClientRect()
        const d = (x0 - x) ** 2 + (y0 - y) ** 2;

        if(d < distance) {
          nearestRange = range
          distance = d
        }
      }
      return nearestRange
    }

    document.addEventListener('selectstart', event => event.preventDefault())
  </script>

</body>

</html>